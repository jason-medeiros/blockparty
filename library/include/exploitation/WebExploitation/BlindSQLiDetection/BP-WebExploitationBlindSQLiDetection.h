/*
 * BP-WebExploitationBlindSQLiDetection.h
 *
 *  Created on: Dec 11, 2011
 */


#ifndef BPWEBEXPLOITATIONBLINDSQLIDETECTION_H_
#define BPWEBEXPLOITATIONBLINDSQLIDETECTION_H_

// simple enumerator detailin the types of blind sqli found
typedef enum BP_WEB_BLINDSQLI_TYPE {
	BP_WEB_BLINDSQLI_TYPE_NONE,
	BP_WEB_BLINDSQLI_TYPE_UNION_SELECT,
	BP_WEB_BLINDSQLI_TYPE_TIME_BENCHMARK
};

// sqli union parameter types
typedef enum BP_WEB_BLIND_SQLI_UNION_PARM_TYPE
{
	BP_WEB_BLIND_SQLI_PARM_TYPE_NONE,
	BP_WEB_BLIND_SQLI_PARM_TYPE_INTEGER,
	BP_WEB_BLIND_SQLI_PARM_TYPE_HEX_STR,
	BP_WEB_BLIND_SQLI_PARM_TYPE_QUOTE_STR,
	BP_WEB_BLIND_SQLI_PARM_TYPE_TIME_BENCHMARK
};

// This structure holds a union select configuration.  These
// structures are only generated upon a successful union select
// blind sql exploitation.
typedef struct _BP_WEB_BLIND_SQLI_UNION_SELECT_PARMS {

	// the type of this parameter
	BP_WEB_BLIND_SQLI_UNION_PARM_TYPE parm_type;

	// the parameter value
	char   parm_value[256];

} BP_WEB_BLIND_SQLI_UNION_SELECT_PARMS, P_BP_WEB_BLIND_SQLI_UNION_SELECT_PARMS;


// This structure holds information regarding found blind sql
// results.  It is housed in reference within the _BP_WEB_SQLINJ_TEST_RESULT
// structure and can be accessed from there in the case that blind
// sql injections are found.
typedef struct _BP_WEB_BLIND_SQLINJ_TEST_RESULT
{

	// the blind sqli detected type
	BP_WEB_BLINDSQLI_TYPE type;

	// database parameters
	size_t db_result_id;

	// if the request was logged in the database, this is its log id
	size_t db_request_log_id;

	// benchmark timeout testing
	size_t actual_request_time;

	// check http get
	char *http_get;

	// check http post string
	char *http_post;

	// check cookie value
	char *http_cookie;

} BP_WEB_BLIND_SQLINJ_TEST_RESULT, *P_BP_WEB_BLIND_SQLINJ_TEST_RESULT;

// Blind SQL Injection Test Structure
typedef struct _BP_WEB_BLIND_SQLINJ_TEST {

	// the front of the test condition
	char *testFront;

	// the end of the test condition
	char *testTail;

	// test type
	BP_WEB_BLINDSQLI_TYPE type;

} BP_WEB_BLIND_SQLINJ_TEST, *P_BP_WEB_BLIND_SQLINJ_TEST;


#endif /* BPWEBEXPLOITATIONBLINDSQLIDETECTION_H_ */
