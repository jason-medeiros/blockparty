/*
 * BP-WebExploitationMatching.h
 *
 *  Created on: Apr 7, 2009
 *      Author: root
 */

#ifndef BPWEBEXPLOITATIONMATCHING_H_
#define BPWEBEXPLOITATIONMATCHING_H_


// Test structure which is represents a buffer containing
// format strings.
typedef struct _BP_FMT_ERR_TESTS{

	// an array of strings used for matching error
	// codes in buffers.
	char **fmtErrTestStrs;

	// the number of strings in the above test array
	size_t numStrs;

} BP_FMT_ERR_TESTS, *P_BP_FMT_ERR_TESTS;


// Returns an allocated null terminated character array containing the
// global format table.
char ** BP_WebExploitGenFormatTable();

// Returns the number of entries in the format table (used primarily
// by the format table deconstrution routine)
size_t BP_WebExploitGetFormatTableEntries();

// Use this routine in order to facilitate buffer matching if the
// error match set contains format strings.  Returns true if the
// match set activated, and false if it does not.
bool BP_TestMatchSet(char *inBuff, size_t buffSize, P_BP_FMT_ERR_TESTS test);

// Generates an error test structure based around an input string
// which may or may not contain a format string.
P_BP_FMT_ERR_TESTS BP_GenerateMatchSetFromTestString(char *inStr, size_t buffSize, char **fmtReplacementTable);



// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
// %%%%%%%%%%%% DECONSTRUCTORS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

// Destroys a set of format error checks, REQUIRES COUNT
size_t BP_DestroyFmtErrTests(BP_FMT_ERR_TESTS * tests, size_t count);


#endif /* BPWEBEXPLOITATIONMATCHING_H_ */
