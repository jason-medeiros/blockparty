/*
 * BP-WebExploitationAppServers.h
 *
 *  Created on: Apr 7, 2009
 *      Author: root
 */

#ifndef BPWEBEXPLOITATIONAPPSERVERS_H_
#define BPWEBEXPLOITATIONAPPSERVERS_H_


enum BP_APPSERVER_ENGINE {
	BP_APPSERVER_ENGINE_NONE,
	BP_APPSERVER_ENGINE_PHP,
	BP_APPSERVER_ENGINE_ASP,
	BP_APPSERVER_ENGINE_JSP,
	BP_APPSERVER_ENGINE_CFM,
	BP_APPSERVER_ENGINE_DNET
};

enum BP_APPSERVER_TARGET_TYPE {
	BP_APPSERVER_TARGET_NONE,
	BP_APPSERVER_TARGET_ANCHOR,
	BP_APPSERVER_TARGET_FORM,
	BP_APPSERVER_TARGET_COOKIE
};

// Test results structure for SQL Injections
typedef struct _BP_WEB_APPSERVER_TEST_RESULT {


	// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	// %%% Request Data Structure %%%%%%%%%%%%%%%%%%%%%%%%%%%
	// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	// request data
	BP_WEB_ANALYSIS_BASIC_REQUEST_DATA request_data;

	// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	// %%% General Result Information %%%%%%%%%%%%%%%%%%%%%%%%%%%%
	// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


	// target type (anchor, form, or cookie)
	BP_APPSERVER_TARGET_TYPE targetType;

	// Appserver engine detection based around alert
	BP_APPSERVER_ENGINE * enginesDetected;

		// Engine detection count
		size_t engineDetectionCount;


	// number of UNIQUE PHP matches made
	size_t phpTestMatchesMade;

		// array of test index matches which were found
		size_t *phpTestMatchIndexes;


	// number of UNIQUE ASP matches made
	size_t aspTestMatchesMade;

		// array of test index matches which were found
		size_t *aspTestMatchIndexes;


	// number of UNIQUE java server pages matches made
	size_t jspTestMatchesMade;

		// array of test index matches which were found
		size_t *jspTestMatchIndexes;


	// number of UNIQUE Macromedia Cold Fusion matches made
	size_t cfmTestMatchesMade;

		// array of test index matches which were found
		size_t *cfmTestMatchIndexes;


	// number of UNIQUE Macromedia Cold Fusion matches made
	size_t dnetTestMatchesMade;

		// array of test index matches which were found
		size_t *dnetTestMatchIndexes;


	// --- ANCHORS ------------------------

	// anchor test string
	char *anchorActualTest;

	// Html anchor entity pointers (only filled out if found in anchor)
	P_BP_HTML_ANCHOR_LIST     anchor;
	P_BP_HTML_ANCHOR_VAR_LIST vulnVar;

	// position in the variable list for the anchor in which
	// vulnVar occurs.
	size_t anchorVarPosition;


	// --- FORMS -------------------------------

	// Html form entity pointers (only filled out if found in form input)
	P_BP_HTML_FORM_LIST form;

	// input structure pointer which contains error generating potential
	P_BP_HTML_INPUT_LIST input;

	// Position in the input list which the vulnInput occurs.
	size_t inputPosition;

	// Input string used to create test
	char *actualInputTest;

		// List pointers
		struct _BP_WEB_APPSERVER_TEST_RESULT * first;
		struct _BP_WEB_APPSERVER_TEST_RESULT * prev;
		struct _BP_WEB_APPSERVER_TEST_RESULT * next;

} BP_WEB_APPSERVER_TEST_RESULT, *P_BP_WEB_APPSERVER_TEST_RESULT;


// This function will return a linked list of the BP_WEB_APPSERVER_TEST_RESULT
// structures which have the appropriate data set within them.  The prototype is
// large but required in order to make this less dependent on other portions
// of the code.  Additionally it makes it simpler to run inline checks during
// assessment procession.  So in short, deal w/ it sucka.

// Also, only set either form or anchor vars if you want non-confusing results.
P_BP_WEB_APPSERVER_TEST_RESULT BP_WebExploitRunAppServerChecks(char *buff,
														size_t buffSize,
														char *anchorActualTest,
														P_BP_HTML_ANCHOR_LIST anchor,
														P_BP_HTML_ANCHOR_VAR_LIST vulnVar,
														size_t anchorVarPosition,
														P_BP_HTML_FORM_LIST form,
														P_BP_HTML_INPUT_LIST vulnInput,
														size_t inputVarPosition,
														P_BP_ASP_ERR_CODES aspErrCodes,
														P_BP_JSP_ERR_CODES jspErrCodes,
														P_BP_PHP_ERR_CODES phpErrCodes,
														P_BP_CFM_ERR_CODES cfmErrCodes);





#endif /* BPWEBEXPLOITATIONAPPSERVERS_H_ */
