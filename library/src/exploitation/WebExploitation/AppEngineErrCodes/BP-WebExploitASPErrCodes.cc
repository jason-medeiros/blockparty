/*
 * BP-WebExploitASPErrCodes.cc
 *
 *  Created on: Apr 7, 2009
 *      Author: root
 */

#include "../../../../include/BP-Main.h"

// ASP error code array
BP_ASP_ERR_CODES aspErrCodes[] = {

	{ (char *)"ASP 0100", (char *)"Out of memory"},
	{ (char *)"ASP 0101", (char *)"Unexpected error"},
	{ (char *)"ASP 0102", (char *)"Expecting string input"},
	{ (char *)"ASP 0103", (char *)"Expecting numeric input"},
	{ (char *)"ASP 0104", (char *)"Operation not Allowed"},
	{ (char *)"ASP 0105", (char *)"Index out of range"},
	{ (char *)"ASP 0106", (char *)"Type Mismatch"},
	{ (char *)"ASP 0107", (char *)"Stack Overflow"},
	{ (char *)"ASP 0108", (char *)"Create object failed"},
	{ (char *)"ASP 0109", (char *)"Member not found"},
	{ (char *)"ASP 0110", (char *)"Unknown name"},
	{ (char *)"ASP 0111", (char *)"Unknown interface"},
	{ (char *)"ASP 0112", (char *)"Missing parameter"},
	{ (char *)"ASP 0113", (char *)"Script timed out"},
	{ (char *)"ASP 0114", (char *)"Object not bpfree threaded"},
	{ (char *)"ASP 0115", (char *)"Unexpected error"},
	{ (char *)"ASP 0116", (char *)"Missing close of script delimiter"},
	{ (char *)"ASP 0117", (char *)"Missing close of script tag"},
	{ (char *)"ASP 0118", (char *)"Missing close of object tag"},
	{ (char *)"ASP 0119", (char *)"Missing Classid or Progid attribute"},
	{ (char *)"ASP 0120", (char *)"Invalid Runat attribute"},
	{ (char *)"ASP 0121", (char *)"Invalid Scope in object tag"},
	{ (char *)"ASP 0122", (char *)"Invalid Scope in object tag"},
	{ (char *)"ASP 0123", (char *)"Missing Id attribute"},
	{ (char *)"ASP 0124", (char *)"Missing Language attribute"},
	{ (char *)"ASP 0125", (char *)"Missing close of attribute"},
	{ (char *)"ASP 0126", (char *)"Include file not found"},
	{ (char *)"ASP 0127", (char *)"Missing close of HTML comment"},
	{ (char *)"ASP 0128", (char *)"Missing File or Virtual attribute"},
	{ (char *)"ASP 0129", (char *)"Unknown scripting language"},
	{ (char *)"ASP 0130", (char *)"Invalid File attribute"},
	{ (char *)"ASP 0131", (char *)"Disallowed Parent Path"},
	{ (char *)"ASP 0132", (char *)"Compilation Error"},
	{ (char *)"ASP 0133", (char *)"Invalid ClassID attribute"},
	{ (char *)"ASP 0134", (char *)"Invalid ProgID attribute"},
	{ (char *)"ASP 0135", (char *)"Cyclic Include"},
	{ (char *)"ASP 0136", (char *)"Invalid object instance name"},
	{ (char *)"ASP 0137", (char *)"Invalid Global Script"},
	{ (char *)"ASP 0138", (char *)"Nested Script Block"},
	{ (char *)"ASP 0139", (char *)"Nested Object"},
	{ (char *)"ASP 0140", (char *)"Page Command Out Of Order"},
	{ (char *)"ASP 0141", (char *)"Page Command Repeated"},
	{ (char *)"ASP 0142", (char *)"Thread token error"},
	{ (char *)"ASP 0143", (char *)"Invalid Application Name"},
	{ (char *)"ASP 0144", (char *)"Initialization Error"},
	{ (char *)"ASP 0145", (char *)"New Application Failed"},
	{ (char *)"ASP 0146", (char *)"New Session Failed"},
	{ (char *)"ASP 0147", (char *)"500 Server Error"},
	{ (char *)"ASP 0148", (char *)"Server Too Busy"},
	{ (char *)"ASP 0149", (char *)"Application Restarting"},
	{ (char *)"ASP 0150", (char *)"Application Directory Error"},
	{ (char *)"ASP 0151", (char *)"Change Notification Error"},
	{ (char *)"ASP 0152", (char *)"Security Error"},
	{ (char *)"ASP 0153", (char *)"Thread Error"},
	{ (char *)"ASP 0154", (char *)"Write HTTP Header Error"},
	{ (char *)"ASP 0155", (char *)"Write Page Content Error"},
	{ (char *)"ASP 0156", (char *)"Header Error"},
	{ (char *)"ASP 0157", (char *)"Buffering On"},
	{ (char *)"ASP 0158", (char *)"Missing URL"},
	{ (char *)"ASP 0159", (char *)"Buffering Off"},
	{ (char *)"ASP 0160", (char *)"Logging Failure"},
	{ (char *)"ASP 0161", (char *)"Data Type Error"},
	{ (char *)"ASP 0162", (char *)"Cannot Modify Cookie"},
	{ (char *)"ASP 0163", (char *)"Invalid Comma Use"},
	{ (char *)"ASP 0164", (char *)"Invalid TimeOut Value"},
	{ (char *)"ASP 0165", (char *)"SessionID Error"},
	{ (char *)"ASP 0166", (char *)"Uninitialized Object"},
	{ (char *)"ASP 0167", (char *)"Session Initialization Error"},
	{ (char *)"ASP 0168", (char *)"Disallowed object use"},
	{ (char *)"ASP 0169", (char *)"Missing object information"},
	{ (char *)"ASP 0170", (char *)"Delete Session Error"},
	{ (char *)"ASP 0171", (char *)"Missing Path"},
	{ (char *)"ASP 0172", (char *)"Invalid Path"},
	{ (char *)"ASP 0173", (char *)"Invalid Path Character"},
	{ (char *)"ASP 0174", (char *)"Invalid Path Character(s)"},
	{ (char *)"ASP 0175", (char *)"Disallowed Path Characters"},
	{ (char *)"ASP 0176", (char *)"Path Not Found"},
	{ (char *)"ASP 0177", (char *)"Server.CreateObject Failed"},
	{ (char *)"ASP 0178", (char *)"Server.CreateObject Access Error"},
	{ (char *)"ASP 0179", (char *)"Application Initialization Error"},
	{ (char *)"ASP 0180", (char *)"Disallowed object use"},
	{ (char *)"ASP 0181", (char *)"Invalid threading model"},
	{ (char *)"ASP 0182", (char *)"Missing object information"},
	{ (char *)"ASP 0183", (char *)"Empty Cookie Key"},
	{ (char *)"ASP 0184", (char *)"Missing Cookie Name"},
	{ (char *)"ASP 0185", (char *)"Missing Default Property"},
	{ (char *)"ASP 0186", (char *)"Error parsing certificate"},
	{ (char *)"ASP 0187", (char *)"Object addition conflict"},
	{ (char *)"ASP 0188", (char *)"Disallowed object use"},
	{ (char *)"ASP 0189", (char *)"Disallowed object use"},
	{ (char *)"ASP 0190", (char *)"Unexpected error"},
	{ (char *)"ASP 0191", (char *)"Unexpected error"},
	{ (char *)"ASP 0192", (char *)"Unexpected error"},
	{ (char *)"ASP 0193", (char *)"OnStartPage Failed"},
	{ (char *)"ASP 0194", (char *)"OnEndPage Failed"},
	{ (char *)"ASP 0195", (char *)"Invalid Server Method Call"},
	{ (char *)"ASP 0196", (char *)"Cannot launch out of process component"},
	{ (char *)"ASP 0197", (char *)"Disallowed object use"},
	{ (char *)"ASP 0198", (char *)"Server shutting down"},
	{ (char *)"ASP 0199", (char *)"Disallowed object use"},
	{ (char *)"ASP 0200", (char *)"Out of Range 'Expires' attribute"},
	{ (char *)"ASP 0201", (char *)"Invalid Default Script Language"},
	{ (char *)"ASP 0202", (char *)"Missing Code Page"},
	{ (char *)"ASP 0203", (char *)"Invalid Code Page"},
	{ (char *)"ASP 0204", (char *)"Invalid CodePage Value"},
	{ (char *)"ASP 0205", (char *)"Change Notification"},
	{ (char *)"ASP 0206", (char *)"Cannot call BinaryRead"},
	{ (char *)"ASP 0207", (char *)"Cannot use Request.Form"},
	{ (char *)"ASP 0208", (char *)"Cannot use generic Request collection"},
	{ (char *)"ASP 0209", (char *)"Illegal value for TRANSACTION property"},
	{ (char *)"ASP 0210", (char *)"Method not implemented"},
	{ (char *)"ASP 0211", (char *)"Object out of scope"},
	{ (char *)"ASP 0212", (char *)"Cannot Clear Buffer"},
	{ (char *)"ASP 0214", (char *)"Invalid Path parameter"},
	{ (char *)"ASP 0215", (char *)"Illegal value for ENABLESESSIONSTATE property"},
	{ (char *)"ASP 0216", (char *)"MSDTC Service not running"},
	{ (char *)"ASP 0217", (char *)"Invalid Scope in object tag"},
	{ (char *)"ASP 0218", (char *)"Missing LCID"},
	{ (char *)"ASP 0219", (char *)"Invalid LCID"},
	{ (char *)"ASP 0220", (char *)"Requests for GLOBAL.ASA Not Allowed"},
	{ (char *)"ASP 0221", (char *)"Invalid @ Command directive"},
	{ (char *)"ASP 0222", (char *)"Invalid TypeLib Specification"},
	{ (char *)"ASP 0223", (char *)"TypeLib Not Found"},
	{ (char *)"ASP 0224", (char *)"Cannot load TypeLib"},
	{ (char *)"ASP 0225", (char *)"Cannot wrap TypeLibs"},
	{ (char *)"ASP 0226", (char *)"Cannot modify StaticObjects"},
	{ (char *)"ASP 0227", (char *)"Server.Execute Failed"},
	{ (char *)"ASP 0228", (char *)"Server.Execute Error"},
	{ (char *)"ASP 0229", (char *)"Server.Transfer Failed"},
	{ (char *)"ASP 0230", (char *)"Server.Transfer Error"},
	{ (char *)"ASP 0231", (char *)"Server.Execute Error"},
	{ (char *)"ASP 0232", (char *)"Invalid Cookie Specification"},
	{ (char *)"ASP 0233", (char *)"Cannot load cookie script source"},
	{ (char *)"ASP 0234", (char *)"Invalid include directive"},
	{ (char *)"ASP 0235", (char *)"Server.Transfer Error"},
	{ (char *)"ASP 0236", (char *)"Invalid Cookie Specification"},
	{ (char *)"ASP 0237", (char *)"Invalid Cookie Specification"},
	{ (char *)"ASP 0238", (char *)"Missing attribute value"},
	{ (char *)"ASP 0239", (char *)"Cannot process file"},
	{ (char *)"ASP 0240", (char *)"Script Engine Exception"},
	{ (char *)"ASP 0241", (char *)"CreateObject Exception"},
	{ (char *)"ASP 0242", (char *)"Query OnStartPage Interface Exception"},
	{ (char *)"ASP 0243", (char *)"Invalid METADATA tag in Global.asa"},
	{ (char *)"ASP 0244", (char *)"Cannot Enable Session State"},
	{ (char *)"ASP 0245", (char *)"Mixed usage of Code Page values"},
	{ (char *)"ASP 0246", (char *)"Too many concurrent users. Please try again later."},
	{ (char *)"ASP 0247", (char *)"Bad Argument to BinaryRead."},
	{ (char *)"ASP 0248", (char *)"Script isn't transacted. This ASP file must be transacted in order to use the ObjectContext object."},
	{ (char *)"ASP 0249", (char *)"Cannot use IStream on Request. Cannot use IStream on Request object after using Request.Form collection or Request.BinaryRead."},
	{ (char *)"ASP 0250", (char *)"Invalid Default Code Page. The default code page specified for this application is invalid."},
	{ (char *)"ASP 0251", (char *)"Response Buffer Limit Exceeded. Execution of the ASP page caused the Response Buffer to exceed its configured limit."}
};




// Generates an allocated array of ASP error codes
P_BP_ASP_ERR_CODES BP_ASPGenErrCodeArray()
{

	size_t retSize = sizeof(aspErrCodes);
	P_BP_ASP_ERR_CODES retTable = (P_BP_ASP_ERR_CODES) bpcalloc(retSize, 1);
	if(!retTable)
		return NULL;

	BP_ASP_ERR_CODES nullCmp;
	memset(&nullCmp, 0x00, sizeof(nullCmp));

	// duplicate the array
	size_t x = 0;
	for(x = 0; ( sizeof(BP_ASP_ERR_CODES) * x ) < sizeof(aspErrCodes); x++){

		// duplicate string in table
		retTable[x].description = bpstrdup(aspErrCodes[x].description);

		// duplicate base code string in table
		retTable[x].aspBaseCode = bpstrdup(aspErrCodes[x].aspBaseCode);

	}

	return retTable;
}


// Generates a list of error code tests based around the
// error code array defined above.  This set is basically
// a string array w/o format strings.
P_BP_FMT_ERR_TESTS BP_ASPGenErrTestsFromErrCodeArray(P_BP_ASP_ERR_CODES inCodes, size_t numCodes, char **fmtReplacementTable){

	if(!inCodes)
		return NULL;

	size_t i = 0;
	P_BP_FMT_ERR_TESTS genSet = NULL;
	BP_FMT_ERR_TESTS * retSet = NULL;


	// set code array pointer into an indexable typedef
	BP_ASP_ERR_CODES * testCodes = (P_BP_ASP_ERR_CODES) inCodes;


	for(i = 0; i < numCodes; i++){

		// increase the size of the return set
		retSet = (BP_FMT_ERR_TESTS *) bprealloc(retSet, ((i+1) * sizeof(BP_FMT_ERR_TESTS)) + sizeof(BP_FMT_ERR_TESTS));

		// generate match set from a string
		genSet = BP_GenerateMatchSetFromTestString(testCodes[i].description, bpstrlen(testCodes[i].description), fmtReplacementTable);
		if(!genSet)
			return NULL;

		// copy in the array data
		memcpy(&retSet[i], genSet, sizeof(BP_FMT_ERR_TESTS));

		// zero out trailing item
		memset(&retSet[i+1], 0x00, sizeof(BP_FMT_ERR_TESTS));

		// destroy chunk structure (dont destroy internal pointers)
		bpfree(genSet);
		genSet = NULL;

	}

	// return the filled out structure
	return (P_BP_FMT_ERR_TESTS) retSet;
}

// Returns the total number of checks within the ASP array.
size_t BP_ASPErrCount()
{

	size_t retCount = sizeof(aspErrCodes) / sizeof(BP_ASP_ERR_CODES);
	return retCount;
}

// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
// %%%%%%%%%%%% DECONSTRUCTORS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

// Destroys a set of ASP error code allocations
size_t BP_DestroyASPErrCodes(BP_ASP_ERR_CODES * codes)
{

	// check to ensure we have codes
	if(!codes)
		return ERR_FAILURE;

	size_t x = 0;
	for(x = 0; x < BP_ASPErrCount(); x++)
	{
		bpfree(codes[x].aspBaseCode);
		bpfree(codes[x].description);
	}

	// NO MORE FREE CODE, NO MORE, NONE lol (memory 4free tho | bovice)
	bpfree(codes);

	// return success
	return ERR_SUCCESS;
}


